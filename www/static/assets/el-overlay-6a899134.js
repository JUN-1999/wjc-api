import{a5 as ye,M as de,bf as Te,a9 as U,bg as Q,A as k,bh as be,bi as Ce,bj as Se,bk as Oe,be as Y,j as K,G as W,ar as fe,e as C,d as ve,Z as _e,f as P,O as Le,D as z,av as we,N as G,J as q,L as j,b as Ae,$ as Ne,a0 as Fe,b2 as ke,bl as Ie,ai as De,bm as Re,bn as Me,S as ee,U as Pe,bo as te}from"./index-5bff1e08.js";import{t as Be,j as ge,U as Ee,b as oe}from"./file-492ec33f.js";import{a as xe}from"./scroll-b04c6969.js";var h=(e=>(e[e.TEXT=1]="TEXT",e[e.CLASS=2]="CLASS",e[e.STYLE=4]="STYLE",e[e.PROPS=8]="PROPS",e[e.FULL_PROPS=16]="FULL_PROPS",e[e.HYDRATE_EVENTS=32]="HYDRATE_EVENTS",e[e.STABLE_FRAGMENT=64]="STABLE_FRAGMENT",e[e.KEYED_FRAGMENT=128]="KEYED_FRAGMENT",e[e.UNKEYED_FRAGMENT=256]="UNKEYED_FRAGMENT",e[e.NEED_PATCH=512]="NEED_PATCH",e[e.DYNAMIC_SLOTS=1024]="DYNAMIC_SLOTS",e[e.HOISTED=-1]="HOISTED",e[e.BAIL=-2]="BAIL",e))(h||{});const he=(e,t={})=>{ye(e)||Be("[useLockscreen]","You need to pass a ref param to this function");const s=t.ns||de("popup"),n=Te(()=>s.bm("parent","hidden"));if(!U||Q(document.body,n.value))return;let a=0,r=!1,c="0";const E=()=>{setTimeout(()=>{Oe(document==null?void 0:document.body,n.value),r&&document&&(document.body.style.width=c)},200)};k(e,l=>{if(!l){E();return}r=!Q(document.body,n.value),r&&(c=document.body.style.width),a=xe(s.namespace.value);const S=document.documentElement.clientHeight<document.body.scrollHeight,m=be(document.body,"overflowY");a>0&&(S||m==="scroll")&&r&&(document.body.style.width=`calc(100% - ${a}px)`),Ce(document.body,n.value)}),Se(()=>E())},Ue=e=>{if(!e)return{onClick:Y,onMousedown:Y,onMouseup:Y};let t=!1,s=!1;return{onClick:c=>{t&&s&&e(c),t=s=!1},onMousedown:c=>{t=c.target===c.currentTarget},onMouseup:c=>{s=c.target===c.currentTarget}}};let F=[];const ne=e=>{const t=e;t.key===fe.esc&&F.forEach(s=>s(t))},Ke=e=>{K(()=>{F.length===0&&document.addEventListener("keydown",ne),U&&F.push(e)}),W(()=>{F=F.filter(t=>t!==e),F.length===0&&U&&document.removeEventListener("keydown",ne)})},V="focus-trap.focus-after-trapped",$="focus-trap.focus-after-released",He="focus-trap.focusout-prevented",se={cancelable:!0,bubbles:!1},Ye={cancelable:!0,bubbles:!1},ae="focusAfterTrapped",ue="focusAfterReleased",Ve=Symbol("elFocusTrap"),Z=C(),H=C(0),J=C(0);let B=0;const pe=e=>{const t=[],s=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const a=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||a?NodeFilter.FILTER_SKIP:n.tabIndex>=0||n===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)t.push(s.currentNode);return t},ce=(e,t)=>{for(const s of e)if(!$e(s,t))return s},$e=(e,t)=>{if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1},ze=e=>{const t=pe(e),s=ce(t,e),n=ce(t.reverse(),e);return[s,n]},Ge=e=>e instanceof HTMLInputElement&&"select"in e,b=(e,t)=>{if(e&&e.focus){const s=document.activeElement;e.focus({preventScroll:!0}),J.value=window.performance.now(),e!==s&&Ge(e)&&t&&e.select()}};function re(e,t){const s=[...e],n=e.indexOf(t);return n!==-1&&s.splice(n,1),s}const je=()=>{let e=[];return{push:n=>{const a=e[0];a&&n!==a&&a.pause(),e=re(e,n),e.unshift(n)},remove:n=>{var a,r;e=re(e,n),(r=(a=e[0])==null?void 0:a.resume)==null||r.call(a)}}},We=(e,t=!1)=>{const s=document.activeElement;for(const n of e)if(b(n,t),document.activeElement!==s)return},le=je(),qe=()=>H.value>J.value,g=()=>{Z.value="pointer",H.value=window.performance.now()},ie=()=>{Z.value="keyboard",H.value=window.performance.now()},Ze=()=>(K(()=>{B===0&&(document.addEventListener("mousedown",g),document.addEventListener("touchstart",g),document.addEventListener("keydown",ie)),B++}),W(()=>{B--,B<=0&&(document.removeEventListener("mousedown",g),document.removeEventListener("touchstart",g),document.removeEventListener("keydown",ie))}),{focusReason:Z,lastUserFocusTimestamp:H,lastAutomatedFocusTimestamp:J}),x=e=>new CustomEvent(He,{...Ye,detail:e}),Je=ve({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[ae,ue,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:t}){const s=C();let n,a;const{focusReason:r}=Ze();Ke(o=>{e.trapped&&!c.paused&&t("release-requested",o)});const c={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},E=o=>{if(!e.loop&&!e.trapped||c.paused)return;const{key:u,altKey:i,ctrlKey:d,metaKey:f,currentTarget:M,shiftKey:I}=o,{loop:w}=e,D=u===fe.tab&&!i&&!d&&!f,A=document.activeElement;if(D&&A){const N=M,[O,R]=ze(N);if(O&&R){if(!I&&A===R){const p=x({focusReason:r.value});t("focusout-prevented",p),p.defaultPrevented||(o.preventDefault(),w&&b(O,!0))}else if(I&&[O,N].includes(A)){const p=x({focusReason:r.value});t("focusout-prevented",p),p.defaultPrevented||(o.preventDefault(),w&&b(R,!0))}}else if(A===N){const p=x({focusReason:r.value});t("focusout-prevented",p),p.defaultPrevented||o.preventDefault()}}};_e(Ve,{focusTrapRef:s,onKeydown:E}),k(()=>e.focusTrapEl,o=>{o&&(s.value=o)},{immediate:!0}),k([s],([o],[u])=>{o&&(o.addEventListener("keydown",E),o.addEventListener("focusin",m),o.addEventListener("focusout",L)),u&&(u.removeEventListener("keydown",E),u.removeEventListener("focusin",m),u.removeEventListener("focusout",L))});const l=o=>{t(ae,o)},S=o=>t(ue,o),m=o=>{const u=P(s);if(!u)return;const i=o.target,d=o.relatedTarget,f=i&&u.contains(i);e.trapped||d&&u.contains(d)||(n=d),f&&t("focusin",o),!c.paused&&e.trapped&&(f?a=i:b(a,!0))},L=o=>{const u=P(s);if(!(c.paused||!u))if(e.trapped){const i=o.relatedTarget;!ge(i)&&!u.contains(i)&&setTimeout(()=>{if(!c.paused&&e.trapped){const d=x({focusReason:r.value});t("focusout-prevented",d),d.defaultPrevented||b(a,!0)}},0)}else{const i=o.target;i&&u.contains(i)||t("focusout",o)}};async function y(){await z();const o=P(s);if(o){le.push(c);const u=o.contains(document.activeElement)?n:document.activeElement;if(n=u,!o.contains(u)){const d=new Event(V,se);o.addEventListener(V,l),o.dispatchEvent(d),d.defaultPrevented||z(()=>{let f=e.focusStartEl;we(f)||(b(f),document.activeElement!==f&&(f="first")),f==="first"&&We(pe(o),!0),(document.activeElement===u||f==="container")&&b(o)})}}}function T(){const o=P(s);if(o){o.removeEventListener(V,l);const u=new CustomEvent($,{...se,detail:{focusReason:r.value}});o.addEventListener($,S),o.dispatchEvent(u),!u.defaultPrevented&&(r.value=="keyboard"||!qe()||o.contains(document.activeElement))&&b(n??document.body),o.removeEventListener($,l),le.remove(c)}}return K(()=>{e.trapped&&y(),k(()=>e.trapped,o=>{o?y():T()})}),W(()=>{e.trapped&&T()}),{onKeydown:E}}});function Xe(e,t,s,n,a,r){return G(e.$slots,"default",{handleKeydown:e.onKeydown})}var ct=Le(Je,[["render",Xe],["__file","/home/runner/work/element-plus/element-plus/packages/components/focus-trap/src/focus-trap.vue"]]);const Qe=q({mask:{type:Boolean,default:!0},customMaskEvent:{type:Boolean,default:!1},overlayClass:{type:j([String,Array,Object])},zIndex:{type:j([String,Number])}}),et={click:e=>e instanceof MouseEvent},tt="overlay";var ot=ve({name:"ElOverlay",props:Qe,emits:et,setup(e,{slots:t,emit:s}){const n=de(tt),a=l=>{s("click",l)},{onClick:r,onMousedown:c,onMouseup:E}=Ue(e.customMaskEvent?void 0:a);return()=>e.mask?Ae("div",{class:[n.b(),e.overlayClass],style:{zIndex:e.zIndex},onClick:r,onMousedown:c,onMouseup:E},[G(t,"default")],h.STYLE|h.CLASS|h.PROPS,["onClick","onMouseup","onMousedown"]):Ne("div",{class:e.overlayClass,style:{zIndex:e.zIndex,position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"}},[G(t,"default")])}});const rt=ot,nt=q({center:{type:Boolean,default:!1},alignCenter:{type:Boolean,default:!1},closeIcon:{type:Fe},customClass:{type:String,default:""},draggable:{type:Boolean,default:!1},fullscreen:{type:Boolean,default:!1},showClose:{type:Boolean,default:!0},title:{type:String,default:""}}),lt={close:()=>!0},it=q({...nt,appendToBody:{type:Boolean,default:!1},beforeClose:{type:j(Function)},destroyOnClose:{type:Boolean,default:!1},closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},modal:{type:Boolean,default:!0},openDelay:{type:Number,default:0},closeDelay:{type:Number,default:0},top:{type:String},modelValue:{type:Boolean,default:!1},modalClass:String,width:{type:[String,Number]},zIndex:{type:Number},trapFocus:{type:Boolean,default:!1}}),dt={open:()=>!0,opened:()=>!0,close:()=>!0,closed:()=>!0,[Ee]:e=>ke(e),openAutoFocus:()=>!0,closeAutoFocus:()=>!0},ft=(e,t)=>{const n=Ie().emit,{nextZIndex:a}=De();let r="";const c=oe(),E=oe(),l=C(!1),S=C(!1),m=C(!1),L=C(e.zIndex||a());let y,T;const o=Re("namespace",Me),u=ee(()=>{const v={},_=`--${o.value}-dialog`;return e.fullscreen||(e.top&&(v[`${_}-margin-top`]=e.top),e.width&&(v[`${_}-width`]=Pe(e.width))),v}),i=ee(()=>e.alignCenter?{display:"flex"}:{});function d(){n("opened")}function f(){n("closed"),n(Ee,!1),e.destroyOnClose&&(m.value=!1)}function M(){n("close")}function I(){T==null||T(),y==null||y(),e.openDelay&&e.openDelay>0?{stop:y}=te(()=>N(),e.openDelay):N()}function w(){y==null||y(),T==null||T(),e.closeDelay&&e.closeDelay>0?{stop:T}=te(()=>O(),e.closeDelay):O()}function D(){function v(_){_||(S.value=!0,l.value=!1)}e.beforeClose?e.beforeClose(v):w()}function A(){e.closeOnClickModal&&D()}function N(){U&&(l.value=!0)}function O(){l.value=!1}function R(){n("openAutoFocus")}function X(){n("closeAutoFocus")}function p(v){var _;((_=v.detail)==null?void 0:_.focusReason)==="pointer"&&v.preventDefault()}e.lockScroll&&he(l);function me(){e.closeOnPressEscape&&D()}return k(()=>e.modelValue,v=>{v?(S.value=!1,I(),m.value=!0,L.value=e.zIndex?L.value++:a(),z(()=>{n("open"),t.value&&(t.value.scrollTop=0)})):l.value&&w()}),k(()=>e.fullscreen,v=>{t.value&&(v?(r=t.value.style.transform,t.value.style.transform=""):t.value.style.transform=r)}),K(()=>{e.modelValue&&(l.value=!0,m.value=!0,I())}),{afterEnter:d,afterLeave:f,beforeLeave:M,handleClose:D,onModalClick:A,close:w,doClose:O,onOpenAutoFocus:R,onCloseAutoFocus:X,onCloseRequested:me,onFocusoutPrevented:p,titleId:c,bodyId:E,closed:S,style:u,overlayDialogStyle:i,rendered:m,visible:l,zIndex:L}};export{rt as E,Ve as F,dt as a,ct as b,nt as c,it as d,lt as e,Ue as f,he as g,ft as u};
